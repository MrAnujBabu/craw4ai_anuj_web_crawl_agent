name = "seo-audit-gateway"
main = "src/index.ts"
compatibility_date = "2025-04-01"
compatibility_flags = ["nodejs_compat"]

# ─── Cloudflare Container (crawl4ai + SEO audit) ─────────────────────
[[containers]]
class_name = "CrawlerContainer"
image = "../docker"                  # path to Dockerfile directory
max_instances = 10
instance_type = "standard-1"        # need CPU + memory for browser

# ─── Durable Object Bindings ─────────────────────────────────────────
[[durable_objects.bindings]]
name = "CRAWLER"
class_name = "CrawlerContainer"

[[durable_objects.bindings]]
name = "MCP_OBJECT"
class_name = "SEOAuditMcpAgent"

# ─── Migrations ──────────────────────────────────────────────────────
[[migrations]]
tag = "v1"
new_sqlite_classes = ["CrawlerContainer"]

[[migrations]]
tag = "v2"
new_sqlite_classes = ["SEOAuditMcpAgent"]

# ─── D1 Database ──────────────────────────────────────────────────────
[[d1_databases]]
binding = "DB"
database_name = "seo-audit-db"
database_id = ""  # Fill after: wrangler d1 create seo-audit-db

# ─── R2 Bucket (raw HTML snapshots) ──────────────────────────────────
[[r2_buckets]]
binding = "SNAPSHOTS"
bucket_name = "seo-audit-snapshots"

# ─── Secrets (set via: wrangler secret put API_KEY) ───────────────────

[vars]
ENVIRONMENT = "production"
MAX_PAGES_DEFAULT = "50"
MAX_DEPTH_DEFAULT = "3"
